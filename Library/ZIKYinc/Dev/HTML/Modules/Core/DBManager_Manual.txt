# ZIKYinc Modular Data Management Library (`db.js`)

---

## Table of Contents

1. [Introduction](#introduction)
2. [Library Overview](#library-overview)
3. [JSON Data Structure](#json-data-structure)
4. [DBManager Class](#dbmanager-class)
    - [Key Features](#key-features)
    - [Class API Reference](#class-api-reference)
    - [Usage Examples](#usage-examples)
5. [Advanced Topics](#advanced-topics)
    - [Defaults and Merging Logic](#defaults-and-merging-logic)
    - [IndexedDB Integration](#indexeddb-integration)
    - [Auto-Merging and Update Placeholders](#auto-merging-and-update-placeholders)
6. [Best Practices](#best-practices)
7. [Project Structure & Documentation](#project-structure--documentation)
8. [Index](#index)

---

## Introduction

Welcome to the documentation for the ZIKYinc Modular Data Management Library, a robust and extensible JavaScript/HTML solution for managing, merging, and synchronizing project, module, and user data using a unified JSON schema and IndexedDB. This library is designed for scalable, maintainable, and future-proof web applications and tools.

---

## Library Overview

- **Purpose:**  
  Centralize all data handling (project, module, user, and defaults) in a modular, extensible way.
- **Architecture:**  
  - Reads structured JSON files describing your app’s data, settings, and user DBs.
  - Loads and merges system-wide defaults, project/module data, and user data.
  - Stores and syncs user data using IndexedDB.
  - Supports future features like auto-merging and update handlers.
- **Use Cases:**  
  - Single-page apps with modular architecture
  - Multi-user web tools
  - Projects requiring persistent user data and configuration

---

## JSON Data Structure

The library expects a well-defined JSON structure. Here’s a simplified overview:

```json
{
  "meta_info": {
    "type": "project",
    "name": "HTML App-Data template (db_update)",
    "cfg": { "auto_merging": false },
    "defaults": { "load_defaults": true, "web": "", "file": "", "priority": "web" }
  },
  "site_settings": { ... },
  "site_data": { ... },
  "module_settings": { ... },
  "module_data": { ... },
  "data": { ... },
  "user_data": {
    "user_database": [ ... ],
    "user_defaults": [ ... ]
  }
}
```

**Key Points:**
- All user DB and default config is under `user_data`.
- `meta_info.defaults` points to master default files (web/file).
- Project and module data are separated for modularity.
- `user_data` is merged directly into IndexedDB.
- 

---

## DBManager Class

### Key Features

- **Modular:** Handles both project and module data layouts.
- **Deep Merging:** Loads master defaults, app defaults, and merges project/module keys.
- **IndexedDB Integration:** Creates and manages user databases and stores.
- **Extensible:** Placeholders for future auto-merging and update handling.
- **Robust API:** Exposes getters for all major data blocks.

---

### Class API Reference

#### Constructor

```js
new DBManager(dbJsonFile)
```
- **dbJsonFile**: Path to your main JSON data file.

#### Core Methods

| Method | Description |
|--------|-------------|
| `initDB()` | Loads all data, merges defaults, opens DBs, initializes stores. |
| `loadAppData()` | Loads/parses the main JSON file. |
| `loadDefaults()` | Loads master defaults, merges app defaults, merges project/module keys. |
| `openAllDatabases()` | Opens all IndexedDB databases from `user_data.user_database`. |
| `initializeAllStores()` | Initializes stores and populates with defaults if needed. |
| `addData(dbId, storeId, data)` | Adds a record to a store. |
| `getData(dbId, storeId, key)` | Retrieves a record by key. |
| `updateData(dbId, storeId, key, data)` | Updates a record. |
| `mergeMissingKeys(dbId, storeId, recordId, newData)` | Merges missing keys into existing records. |
| `refreshAppData()` | Reloads the JSON config. |

#### Data Accessors

| Method | Description |
|--------|-------------|
| `getMetaInfo()` | Returns the meta_info block. |
| `getSiteSettings()` | Returns the site_settings block. |
| `getSiteData()` | Returns the site_data block. |
| `getModuleSettings()` | Returns the module_settings block. |
| `getModuleData()` | Returns the module_data block. |
| `getData()` | Returns the data block. |
| `getUserData()` | Returns the user_data block. |
| `getFieldData()` | Returns a composite of field data and settings. |

#### Placeholders

| Method | Description |
|--------|-------------|
| `get_merge_list()` | Placeholder for auto-merging logic. |
| `MergeData()` | Placeholder for merging logic. |
| `HandleOldData()` | Placeholder for post-merge cleanup. |
| `UpdateHandler()` | Placeholder for update handling logic. |

---

### Usage Examples

#### 1. Basic Initialization

```js
import { DBManager } from './db.js';

const db = new DBManager('appdata.json');
await db.initDB();
```

#### 2. Accessing Data Blocks

```js
const meta = db.getMetaInfo();
const siteSettings = db.getSiteSettings();
const userData = db.getUserData();
```

#### 3. Adding and Retrieving Data

```js
await db.addData('SZMDB', 'USER', { id: 1, name: 'Alice' });
const user = await db.getData('SZMDB', 'USER', 1);
```

#### 4. Updating Records

```js
await db.updateData('SZMDB', 'USER', 1, { name: 'Alice Updated' });
```

#### 5. Deep Merging Example

```js
// Custom merge two objects (deep merge)
const merged = db.mergeData({ a: 1, b: { c: 2 } }, { b: { d: 3 } });
// Result: { a: 1, b: { c: 2, d: 3 } }
```

---

## Advanced Topics

### Defaults and Merging Logic

- **Master Defaults:** Loaded first from `meta_info.defaults` (web/file, priority respected).
- **App Defaults:** If a `defaults` key exists at the top level, it is merged next.
- **Project/Module Data:** Only these keys are merged into the in-memory config:
    - `site_data`
    - `module_settings`
    - `module_data`
    - `data`
- **User Data:** Is never merged into in-memory config; it is handled by IndexedDB logic only.

### IndexedDB Integration

- **user_data.user_database:** Defines all DBs and stores to be created.
- **user_data.user_defaults:** Populates stores with default records if they don’t exist.
- **CRUD Operations:** Provided for all IndexedDB stores.

### Auto-Merging and Update Placeholders

- **Auto-Merging:**  
  Placeholder functions (`get_merge_list`, `MergeData`, `HandleOldData`) are ready for future logic to merge/clean project/module data automatically.
- **Update Handler:**  
  Placeholder (`UpdateHandler`) for syncing scripts/data as defined in `site_settings.sync`.

---

## Best Practices

- **Write Modular JSON:**  
  Keep user, project, and module data separate for maintainability.
- **Document Your Structure:**  
  Use `desc` and `info` fields for tooltips and dev reference.
- **Version Control:**  
  Store your Markdown docs and JSON configs in Git for easy tracking.
- **Consistent Naming:**  
  Use clear, consistent key names and document all changes.
- **Markdown for Docs:**  
  Write all documentation in Markdown for easy readability and maintenance[7][9][10].

---

## Project Structure & Documentation

```
project-root/
├── docs/
│   ├── index.md
│   ├── api-reference.md
│   ├── usage-examples.md
│   └── advanced-topics.md
├── modules/
│   └── core/
│       └── data/
│           └── db.js
├── appdata.json
└── master_defaults.json
```

- **docs/**: All documentation in Markdown.
- **modules/core/data/db.js**: Main library file.
- **appdata.json**: Main project/module data file.
- **master_defaults.json**: System-wide defaults.

---

## Index

| Section | Description |
|---------|-------------|
| [Introduction](#introduction) | Overview of the library |
| [Library Overview](#library-overview) | Purpose and architecture |
| [JSON Data Structure](#json-data-structure) | Data format and keys |
| [DBManager Class](#dbmanager-class) | API and usage |
| [Advanced Topics](#advanced-topics) | Merging, IndexedDB, placeholders |
| [Best Practices](#best-practices) | Tips for maintainable projects |
| [Project Structure & Documentation](#project-structure--documentation) | Directory layout |
| [Index](#index) | Quick reference |

---

## Further Reading

- [Markdown for Technical Writers: Tips, Tricks, and Best Practices][7]
- [Efficiently Document APIs with Markdown][9]
- [Markdown Best Practices (GitHub)][10]
- [MkDocs User Guide][6]
- [markdown-it GitHub][8]

---

**ZIKYinc Modular Data Management Library**  
*Created by Juelz-101 | Version 1.0.0 | Last updated: 2025-05-06*

---

> **Need more examples, want to see a full code sample, or have a question?  
> Open an issue or ping the maintainer. If you break it, you get to keep both pieces.**

---
